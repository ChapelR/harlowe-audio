;(function () {
    /**
     * Harlowe Audio Library, by Chapel, v1.0.0
     *
     * Released under the Unlicense, and dedicated to the public domain.
    **/

    var options = {
        preload : true,
        loadDelay : 0,
        muteOnBlur : true,
        startingVol : 0.5,
        storagekey : '%%tw-audio',
        persistPrefs : true,
        globalA : true,
        includeFixes : false,
        controls : {
            show : true,
            startClosed : true,
            volumeDisplay : true
        },
        loadLimit : {
            track : 500,
            total : 8000
        }
    };

    !function(){"use strict";var e=$(document.createElement("div")).attr("id","audio-container").css("display","none").appendTo(document.body),t=function(t,e){if(window.localStorage)try{t=""+t,"string"!=typeof e&&(e=JSON.stringify(e)),window.localStorage.setItem(t,e)}catch(t){console.error(t)}},o=function(t){if(window.localStorage)try{return t=""+t,window.localStorage.getItem(t)}catch(t){console.error(t)}},n=function(t){if(window.localStorage)try{t=""+t,window.localStorage.removeItem(t)}catch(t){console.error(t)}};function i(e,o){if("object"!=typeof e||"object"!=typeof o)throw new Error("Invalid extension.");Object.keys(o).forEach(function(t){if(void 0!==e[t])throw new Error('Invalid extension: cannot clobber existing property "'+t+'"');e[t]=o[t]})}var a={loaded:[],classes:{},master:{volume:options.startingVol,mute:!1},groups:{playing:[],looping:[],custom:{}},mute:function(t){a.master.mute=!!t,$(document).trigger({type:":master-mute",mute:!!t})},isMuted:function(){return!!a.master.mute},volume:function(t){t=Number(t),Number.isNaN(t)||(1<t?t=1:t<0&&(t=0),a.master.volume=t),$(document).trigger({type:":master-volume",volume:t})},getVolume:function(){return a.master.volume},stopAll:function(){s.list.forEach(function(t){t.stop()})},audioPlaying:function(){return!!a.groups.playing.length},savePrefs:function(){t(options.storagekey,a.master)},loadPrefs:function(){var t=o(options.storagekey);t&&"object"==typeof t&&t.hasOwnProperty("volume")&&"number"==typeof t.volume&&t.hasOwnProperty("mute")&&"boolean"==typeof t.volume&&(delete a.master,a.master=t)},clearPrefs:function(){n(options.storagekey)}},r={aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"};function u(t){throw new Error(t)}function s(t,e,o){this instanceof s||u("Track: called without `new` operator"),t||u("Track: no id specified"),"string"!=typeof t&&u("Track: track id is not a string"),(!e||Array.isArray(e)&&!e.length)&&u("Track: no sources specified"),o&&(e=[].slice.call(arguments).slice(1));var i=$(document.createElement("audio"));e.forEach(function(t){var e,o,n;$(document.createElement("source")).attr({src:t,type:(e=t,o=e.split("."),n=o[o.length-1],n.includes("?")&&(n=n.split("?")[0]),n=n.toLowerCase().trim(),Object.keys(r).includes(n)||u('Track: unsupported file type "'+n+'"'),r[n])}).appendTo(i)}),i.attr({"data-track":"id","data-volume":1,"data-mute":!1}).one("canplay",function(){a.loaded.push(t)}),options.preload&&i.attr("preload","auto"),i[0].volume=1*a.master.volume,this.id=t,this.$el=i,this.unwrap=i[0],this.sources=e}function c(t,e){if(!(this instanceof c))return new c(t,e);this.id=t,this.tracks=e.map(function(t){return s.get(t)}),this.looping=!1,this.current="",this.playing=!1}s.list=[],s.is=function(t){return t instanceof s},s.has=function(e){return s.list.some(function(t){return t.id===e})},s.emit=function(t,e){$(document).trigger({type:t,track:e}),e.emit(t)},s.add=function(t){var e=new s(t,[].slice.call(arguments).slice(1));return s.list.push(e),e.$el.on("canplay",function(){s.emit(":available",e)}),e.$el.on("canplaythrough",function(){s.emit(":loaded",e)}),e.attach(),e},s.renew=function(){s.list.forEach(function(t){t.mute(t.isMuted()),t.volume(t.getVolume())})},s.getIdx=function(e){return s.list.findIndex(function(t){return t.id===e})},s.get=function(e){return s.list.find(function(t){return t.id===e})},s.extend=function(t){i(s,t)},s.extendPrototype=function(t){i(s.prototype,t)},s.removeFromDOM=function(t){"string"==typeof t&&(t=s.get(t)),t&&s.is(t)?t.unattach():e.remove()},s.prototype={constructor:s,emit:function(t){this.$el.trigger({type:t,track:this})},clone:function(){return new s(this.id,this.sources)},isAttached:function(){return $.contains(e[0],this.unwrap)},attach:function(){return this.isAttached()||this.$el.appendTo(e),this},unattach:function(){return this.isAttached()&&this.$el.remove(),this},isPlaying:function(){return!this.unwrap.paused},play:function(){var t=this;return this.unwrap.play(),s.emit(":play",this),this.$el.on("ended",function(){t.unwrap.loop||(t.unwrap.currentTime=0,s.emit(":stop",t))}),this},playWhenPossible:function(){var e=this;return this.unwrap.play().then(function(){s.emit(":play",e),e.$el.on("ended",function(){e.unwrap.loop||(e.unwrap.currentTime=0,s.emit(":stop",e))})},function(t){$(document).one("click mousedown keydown touchstart",function(){e.play()})}).catch(function(t){console.error(t)}),this},forcePlay:function(){var t=this,e=$(document.createElement("a")).css("display","none").appendTo(document.body).on("click",function(){t.play()});setTimeout(function(){e.trigger("click")},100)},pause:function(){return this.unwrap.pause(),s.emit(":pause",this),this},stop:function(){return this.unwrap.pause(),this.unwrap.currentTime=0,s.emit(":stop",this),this},mute:function(t){return t=!!t,this.$el.attr("data-mute",t),a.master.mute?this.unwrap.muted=!0:this.unwrap.muted=t,s.emit(":mute",this),this},isMuted:function(){var t=this.$el.attr("data-mute");return"boolean"==typeof t?t:"false"!==t},toggleMute:function(){return this.mute(!this.isMuted()),this},volume:function(t){return t=Number(t),Number.isNaN(t)||(1<t?t=1:t<0&&(t=0),this.$el.attr("data-volume",t),this.unwrap.volume=t*a.master.volume),s.emit(":volume",this),this},getVolume:function(){return Number(this.$el.attr("data-volume"))},addToGroup:function(t,e){var o=this,n=e?a.groups.custom[t]:a.groups[t];return n.some(function(t){return o.id===t.id})||n.push(this),this},removeFromGroup:function(t,e){var o=this,n=e?a.groups.custom[t]:a.groups[t],i=n.findIndex(function(t){return t.id&&t.id===o.id});return n.splice(i,1),this},loop:function(t){return this.unwrap.loop=!!t,this.unwrap.loop?this.addToGroup("looping"):this.removeFromGroup("looping"),this},isLooping:function(){return!!this.unwrap.loop},toggleLoop:function(){return this.loop(!this.isLooping()),this},seek:function(t){return t<0?t=this.unwrap.duration-t:t>this.unwrap.duration&&(t=this.unwrap.duration),this.unwrap.currentTime=t,this},fadeIn:function(t){var e=this;t=t||1;var o=this.getVolume();return this.volume(0),this.play(),this.$el.animate({volume:o*a.master.volume},1e3*t,function(){e.volume(o),s.emit(":volume",e),s.emit(":fade",e)}),this},fadeOut:function(t){t=t||1;var e=this,o=this.getVolume();return this.$el.animate({volume:0},1e3*t,function(){e.stop(),e.volume(o),s.emit(":volume",e),s.emit(":fade",e)}),this},fadeTo:function(t,e){var o=this;if(t=t||1,e=Number(e),!Number.isNaN(e))return 1<e?e=1:e<0&&(e=0),this.$el.animate({volume:e*a.master.volume},1e3*t,function(){o.volume(e),s.emit(":volume",o),s.emit(":fade",o)}),this;alert("ivalid volume level")},delay:function(t,e){var o=this;"function"==typeof e&&(t=Number(t),(Number.isNaN(t)||t<0)&&(t=0),setTimeout(function(){e.call(o,o,t)},t))}},$(document).on(":master-mute",s.renew),$(document).on(":master-volume",s.renew),options.persistPrefs&&($(document).on(":master-mute",a.savePrefs),$(document).on(":master-volume",a.savePrefs)),$(document).on(":play",function(t){t.track.addToGroup("playing")}),$(document).on(":stop",function(t){t.track.removeFromGroup("playing")}),options.muteOnBlur&&$(window).on("blur",function(){a.isMuted()||(a.mute(!0),$(window).one("focus",function(){a.mute(!1)}))}),a.classes.Track=s,a.newTrack=s.add,a.track=s.get,a.createGroup=function(t,e,o){var n,i,r;n=o?[].slice.call(arguments).slice(1):e,i=t,(r=n)&&Array.isArray(r)||(r=[]),a.groups.custom[i]=r.map(function(t){return s.get(t)})},a.group=function(t){if(!(this instanceof a.group))return new a.group(t);Object.keys(a.groups.custom).includes(t)?this.members=a.groups.custom[t]:this.members=a.groups[t],Array.isArray(this.members)||(this.members=[],console.error('Could not find members for track group "'+t+'"!'))},a.group.is=function(t){return this instanceof a.group},a.group.runOnAll=function(t,e,o){t.members.forEach(function(t){t[e].apply(t,o&&Array.isArray(o)?o:[])})},a.group.extend=function(t){i(a.group,t)},a.group.extendPrototype=function(t){i(a.group.prototype,t)},a.group.prototype={constructor:a.group,run:function(t,e,o){null!=o&&(e=[].slice.call(arguments).slice(1)),s.prototype.hasOwnProperty(t)&&a.group.runOnAll(this,t,e)},play:function(){return this.run("play"),this},pause:function(){return this.run("pause"),this},stop:function(){return this.run("stop"),this},mute:function(t){return this.run("mute",[t]),this},volume:function(t){return this.run("volume",[t]),this},loop:function(t){return this.run("loop",[t]),this}},c.list={},c.is=function(t){return t instanceof c},c.add=function(t,e,o){return o&&(e=[].slice.call(arguments).slice(1)),c.list[t]=new c(t,e),c.list[t]},c.extend=function(t){i(c,t)},c.extendPrototype=function(t){i(c.prototype,t)},c.prototype={constructor:c,clone:function(){return new c(this.id,this.tracks.map(function(t){return t.id}))},shuffle:function(){var t,e,o,n=this.tracks;for(o=n.length-1;0<o;o--)t=Math.floor(Math.random()*(o+1)),e=n[o],n[o]=n[t],n[t]=e;return this.tracks=n,this},random:function(){return this.tracks[Math.floor(Math.random()*this.tracks.length)]},isPlaying:function(){return this.playing},play:function(t){var e=this;if((t=t||(e.current?e.tracks.findIndex(function(t){return t.id===e.current}):0))>=e.tracks.length&&e.looping)t=0;else if(t>=e.tracks.length)return e.current="",void(e.playing=!1);var o=e.tracks[t],n=o.isLooping();return o.loop(!1),o.play(),e.playing=!0,setTimeout(function(){o.isPlaying()||(e.playing=!1)},20),e.current=o.id,o.$el.one("ended.playlist",function(){t++,o.loop(n),e.play(t)}),e},loop:function(t){return this.looping=!!t,this},stop:function(){var t=s.get(this.current);return t.stop(),t.$el.off(".playlist"),this.current="",this.playing=!1,this},pause:function(){return s.get(this.current).pause(),this.playing=!1,this}},a.classes.Playlist=c,a.createPlaylist=c.add,a.playlist=function(t){return c.list[t]||null},a.extend=function(t){i(a,t)},a.extendTrack=s.extend,a.extendTrackProto=s.extendPrototype,a.extendGroup=a.group.extend,a.extendGroupProto=a.group.extendPrototype,a.extendPlaylist=c.extend,a.extendPlaylistProto=c.extendPrototype,window.Chapel=window.Chapel||{},window.Chapel.Audio=a,options.persistPrefs&&a.loadPrefs()}(),function(){"use strict";if(options.controls.show){var t=$(document.createElement("div")).attr("id","story-menu").css("display","none"),e=$(document.createElement("span")).attr("id","vol-title").append("Volume");options.controls.volumeDisplay||e.css("display","none");var o=$(document.createElement("input")).attr({id:"audio-volume",type:"range",min:1,max:99,step:1,title:"Volume"}),n=Math.trunc(100*window.Chapel.Audio.master.volume);n<0?n=0:100<n&&(n=100),o.attr("value",n);var i=function(t){void 0===t&&(t=o.val()),e.empty().append("Volume "+t)};o.on("input",function(){window.Chapel.Audio.volume($(this).val()/100),i($(this).val())});var r=$(document.createElement("tw-link")).attr({id:"audio-mute",title:"Mute"}).append("Mute <span></span>").on("click",function(t){t.preventDefault(),$(this).toggleClass("muted"),Chapel.Audio.mute(!Chapel.Audio.isMuted())});Chapel.Audio.isMuted()&&r.addClass("muted");var a=$(document.createElement("tw-link")).attr("id","audio-panel-toggle").on("click",function(t){t.preventDefault(),u.toggleClass("closed")}),u=$(document.createElement("div")).attr("id","audio-controls").append(t,e,o,r,a).appendTo(document.body);options.controls.startClosed&&u.addClass("closed"),window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.controls={$panel:u,$volume:o,$mute:r,$user:t,close:function(){u.addClass("closed")},open:function(){u.removeClass("closed")},toggle:function(){u.toggleClass("closed")},hide:function(){u.css("display","none")},show:function(){u.css("display","block")},updateVolume:i}}}(),function(t){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),function(){"use strict";var e=State,t=$(document.createElement("div")).attr("id","audio-overlay").css("display","none").appendTo(document.body);function o(){t.css("display","block").append('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>')}function u(){t.fadeOut(function(){t.empty()})}window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.loadScreen={show:o,dismiss:u,kill:function(){$("#audio-overlay").remove()}},window.Chapel.Audio.$overlay=t,window.Chapel.Audio.preload=function(){if(!(e.pastLength||e.futureLength||$.browser.mobile)){$(document).ready(function(){o()});var i=100+options.loadDelay,t=Chapel.Audio.classes.Track.list,r=Chapel.Audio.loaded;if(t.length){var a=t.map(function(t){return t.id});options.forceDismiss&&setTimeout(function(){u()},options.loadLimit.total),function t(){if(a.length){var e=a.shift();if(r.includes(e))t();else{var o=Chapel.Audio.classes.Track.get(e);if(o.unwrap.readyState<2){var n=!1;o.$el.one("canplay",function(){t(),n=!0}),setTimeout(function(){n||(o.$el.off("canplay"),t())},options.loadLimit.track)}else r.includes(e)||r.push(e),t()}}else setTimeout(u,i)}()}else setTimeout(u,i)}}}(),function(){"use strict";options.globalA&&void 0===window.A&&(window.A=window.Chapel.Audio),$(document).on("unload",function(){window.Chapel.Audio.savePrefs()}),Chapel.Audio.classes.Track.renew(),Chapel.Audio.controls.updateVolume()}(),function(){"use strict";var u=Engine,s=Chapel.Audio.controls.$user;function t(){return"none"!==s.css("display")}function c(){return t()||s.css("display","block"),s}function e(){return t()&&s.css("display","none"),s}Chapel.Audio.menu={hide:e,show:c,isShown:t,links:{add:function(t,e,o){var n,i;if(!t||"string"!=typeof t){var r="undefined";return alert(r),void console.error(r)}o||"function"!=typeof e?(e&&"string"==typeof e&&(n=e),o&&"function"==typeof o&&(i=o)):(i=e,n=null);var a=$(document.createElement("tw-link")).append(t).attr({tabindex:"0",name:t.toLowerCase().trim()}).on("click",function(){n&&u.goToPassage(n),i&&i()}).addClass("story-menu").appendTo(s);return c(),a},clear:function(){return s.empty(),e()},hide:function(t){t=t.toLowerCase().trim(),$('tw-link.story-menu[name="'+t+'"]').addClass("hide")},show:function(t){t=t.toLowerCase().trim(),$('tw-link.story-menu[name="'+t+'"]').removeClass("hide")},toggle:function(t){t=t.toLowerCase().trim(),$('tw-link.story-menu[name="'+t+'"]').toggleClass("hide")},remove:function(t){t=t.toLowerCase().trim(),$('tw-link.story-menu[name="'+t+'"]').remove()}}}}(),function(){"use strict";var n=window.prompt;window.prompt=function(){var t,e,o=n.apply(null,[].slice.call(arguments));return t=o,e=(new DOMParser).parseFromString(t,"text/html"),Array.from(e.body.childNodes).some(function(t){return 1===t.nodeType})?o.replace(/[<>]/g,""):o}}();

}());