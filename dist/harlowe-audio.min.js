;(function () {
    /**
     * Harlowe Audio Library, by Chapel, v1.0.0
     *
     * Released under the Unlicense, and dedicated to the public domain.
    **/

    var options = {
        preload : true,
        loadDelay : 0,
        muteOnBlur : true,
        startingVol : 0.5,
        storagekey : '%%tw-audio',
        persistPrefs : true,
        globalA : true,
        includeFixes : false,
        controls : {
            show : true,
            startClosed : true
        },
        forceDismiss : 5000
    };

    !function(){"use strict";var e=$(document.createElement("div")).attr("id","audio-container").css("display","none").appendTo(document.body),t=function(t,e){if(window.localStorage)try{t=""+t,"string"!=typeof e&&(e=JSON.stringify(e)),window.localStorage.setItem(t,e)}catch(t){console.error(t)}},o=function(t){if(window.localStorage)try{return t=""+t,window.localStorage.getItem(t)}catch(t){console.error(t)}},n=function(t){if(window.localStorage)try{t=""+t,window.localStorage.removeItem(t)}catch(t){console.error(t)}};function i(e,o){if("object"!=typeof e||"object"!=typeof o)throw new Error("Invalid extension.");Object.keys(o).forEach(function(t){if(void 0!==e[t])throw new Error('Invalid extension: cannot clobber existing property "'+t+'"');e[t]=o[t]})}var u={loaded:[],classes:{},master:{volume:options.startingVol,mute:!1},groups:{playing:[],looping:[],custom:{}},mute:function(t){u.master.mute=!!t,$(document).trigger({type:":master-mute",mute:!!t})},isMuted:function(){return!!u.master.mute},volume:function(t){t=Number(t),Number.isNaN(t)||(1<t?t=1:t<0&&(t=0),u.master.volume=t),$(document).trigger({type:":master-volume",volume:t})},getVolume:function(){return u.master.volume},stopAll:function(){a.list.forEach(function(t){t.stop()})},audioPlaying:function(){return!!u.groups.playing.length},savePrefs:function(){t(options.storagekey,u.master)},loadPrefs:function(){var t=o(options.storagekey);t&&"object"==typeof t&&t.hasOwnProperty("volume")&&"number"==typeof t.volume&&t.hasOwnProperty("mute")&&"boolean"==typeof t.volume&&(delete u.master,u.master=t)},clearPrefs:function(){n(options.storagekey)}},r={aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"};function s(t){throw new Error(t)}function a(t,e,o){this instanceof a||s("Track: called without `new` operator"),t||s("Track: no id specified"),"string"!=typeof t&&s("Track: track id is not a string"),(!e||Array.isArray(e)&&!e.length)&&s("Track: no sources specified"),o&&(e=[].slice.call(arguments).slice(1));var i=$(document.createElement("audio"));e.forEach(function(t){var e,o,n;$(document.createElement("source")).attr({src:t,type:(e=t,o=e.split("."),n=o[o.length-1],n.includes("?")&&(n=n.split("?")[0]),n=n.toLowerCase().trim(),Object.keys(r).includes(n)||s('Track: unsupported file type "'+n+'"'),r[n])}).appendTo(i)}),i.attr({"data-track":"id","data-volume":1,"data-mute":!1}).one("canplay",function(){u.loaded.push(t)}),options.preload&&i.attr("preload","auto"),i[0].volume=1*u.master.volume,this.id=t,this.$el=i,this.unwrap=i[0],this.sources=e}function c(t,e){if(!(this instanceof c))return new c(t,e);this.id=t,this.tracks=e.map(function(t){return a.get(t)}),this.looping=!1,this.current="",this.playing=!1}a.list=[],a.is=function(t){return t instanceof a},a.has=function(e){return a.list.some(function(t){return t.id===e})},a.emit=function(t,e){$(document).trigger({type:t,track:e}),e.emit(t)},a.add=function(t){var e=new a(t,[].slice.call(arguments).slice(1));return a.list.push(e),e.$el.on("canplay",function(){a.emit(":available",e)}),e.$el.on("canplaythrough",function(){a.emit(":loaded",e)}),e.attach(),e},a.renew=function(){a.list.forEach(function(t){t.mute(t.isMuted()),t.volume(t.getVolume())})},a.getIdx=function(e){return a.list.findIndex(function(t){return t.id===e})},a.get=function(e){return a.list.find(function(t){return t.id===e})},a.extend=function(t){i(a,t)},a.extendPrototype=function(t){i(a.prototype,t)},a.removeFromDOM=function(t){"string"==typeof t&&(t=a.get(t)),t&&a.is(t)?t.unattach():e.remove()},a.prototype={constructor:a,emit:function(t){this.$el.trigger({type:t,track:this})},clone:function(){return new a(this.id,this.sources)},isAttached:function(){return $.contains(e[0],this.unwrap)},attach:function(){return this.isAttached()||this.$el.appendTo(e),this},unattach:function(){return this.isAttached()&&this.$el.remove(),this},isPlaying:function(){return!this.unwrap.paused},play:function(){var t=this;return this.unwrap.play(),a.emit(":play",this),this.$el.on("ended",function(){t.unwrap.loop||(t.unwrap.currentTime=0,a.emit(":stop",t))}),this},playWhenPossible:function(){var e=this;return this.unwrap.play().then(function(){a.emit(":play",e),e.$el.on("ended",function(){e.unwrap.loop||(e.unwrap.currentTime=0,a.emit(":stop",e))})},function(t){$(document).one("click mousedown keydown touchstart",function(){e.play()})}).catch(function(t){console.error(t)}),this},forcePlay:function(){var t=this,e=$(document.createElement("a")).css("display","none").appendTo(document.body).on("click",function(){t.play()});setTimeout(function(){e.trigger("click")},100)},pause:function(){return this.unwrap.pause(),a.emit(":pause",this),this},stop:function(){return this.unwrap.pause(),this.unwrap.currentTime=0,a.emit(":stop",this),this},mute:function(t){return t=!!t,this.$el.attr("data-mute",t),u.master.mute?this.unwrap.muted=!0:this.unwrap.muted=t,a.emit(":mute",this),this},isMuted:function(){var t=this.$el.attr("data-mute");return"boolean"==typeof t?t:"false"!==t},toggleMute:function(){return this.mute(!this.isMuted()),this},volume:function(t){return t=Number(t),Number.isNaN(t)||(1<t?t=1:t<0&&(t=0),this.$el.attr("data-volume",t),this.unwrap.volume=t*u.master.volume),a.emit(":volume",this),this},getVolume:function(){return Number(this.$el.attr("data-volume"))},addToGroup:function(t,e){var o=this,n=e?u.groups.custom[t]:u.groups[t];return n.some(function(t){return o.id===t.id})||n.push(this),this},removeFromGroup:function(t,e){var o=this,n=e?u.groups.custom[t]:u.groups[t],i=n.findIndex(function(t){return t.id&&t.id===o.id});return n.splice(i,1),this},loop:function(t){return this.unwrap.loop=!!t,this.unwrap.loop?this.addToGroup("looping"):this.removeFromGroup("looping"),this},isLooping:function(){return!!this.unwrap.loop},toggleLoop:function(){return this.loop(!this.isLooping()),this},seek:function(t){return t<0?t=this.unwrap.duration-t:t>this.unwrap.duration&&(t=this.unwrap.duration),this.unwrap.currentTime=t,this},fadeIn:function(t){var e=this;t=t||1;var o=this.getVolume();return this.volume(0),this.play(),this.$el.animate({volume:o*u.master.volume},1e3*t,function(){e.volume(o),a.emit(":volume",e),a.emit(":fade",e)}),this},fadeOut:function(t){t=t||1;var e=this,o=this.getVolume();return this.$el.animate({volume:0},1e3*t,function(){e.stop(),e.volume(o),a.emit(":volume",e),a.emit(":fade",e)}),this},fadeTo:function(t,e){t=t||1;this.getVolume();return e=Number(e),Number.isNaN(e)||(1<e?e=1:e<0&&(e=0)),this.volume(0),this.$el.animate({volume:target*u.master.volume},1e3*t,function(){a.emit(":volume",self),a.emit(":fade",self)}),this},delay:function(t,e){var o=this;"function"==typeof e&&(t=Number(t),(Number.isNaN(t)||t<0)&&(t=0),setTimeout(function(){e.call(o,o,t)},t))}},$(document).on(":master-mute",a.renew),$(document).on(":master-volume",a.renew),options.persistPrefs&&($(document).on(":master-mute",u.savePrefs),$(document).on(":master-volume",u.savePrefs)),$(document).on(":play",function(t){t.track.addToGroup("playing")}),$(document).on(":stop",function(t){t.track.removeFromGroup("playing")}),options.muteOnBlur&&$(window).on("blur",function(){u.isMuted()||(u.mute(!0),$(window).one("focus",function(){u.mute(!1)}))}),u.classes.Track=a,u.newTrack=a.add,u.track=a.get,u.createGroup=function(t,e,o){var n,i,r;n=o?[].slice.call(arguments).slice(1):e,i=t,(r=n)&&Array.isArray(r)||(r=[]),u.groups.custom[i]=r.map(function(t){return a.get(t)})},u.group=function(t){if(!(this instanceof u.group))return new u.group(t);Object.keys(u.groups.custom).includes(t)?this.members=u.groups.custom[t]:this.members=u.groups[t],Array.isArray(this.members)||(this.members=[],console.error('Could not find members for track group "'+t+'"!'))},u.group.is=function(t){return this instanceof u.group},u.group.runOnAll=function(t,e,o){t.members.forEach(function(t){t[e].apply(t,o&&Array.isArray(o)?o:[])})},u.group.extend=function(t){i(u.group,t)},u.group.extendPrototype=function(t){i(u.group.prototype,t)},u.group.prototype={constructor:u.group,run:function(t,e,o){null!=o&&(e=[].slice.call(arguments).slice(1)),a.prototype.hasOwnProperty(t)&&u.group.runOnAll(this,t,e)},play:function(){return this.run("play"),this},pause:function(){return this.run("pause"),this},stop:function(){return this.run("stop"),this},mute:function(t){return this.run("mute",[t]),this},volume:function(t){return this.run("volume",[t]),this},loop:function(t){return this.run("loop",[t]),this}},c.list={},c.is=function(t){return t instanceof c},c.add=function(t,e,o){return o&&(e=[].slice.call(arguments).slice(1)),c.list[t]=new c(t,e),c.list[t]},c.extend=function(t){i(c,t)},c.extendPrototype=function(t){i(c.prototype,t)},c.prototype={constructor:c,clone:function(){return new c(this.id,this.tracks.map(function(t){return t.id}))},shuffle:function(){var t,e,o,n=this.tracks;for(o=n.length-1;0<o;o--)t=Math.floor(Math.random()*(o+1)),e=n[o],n[o]=n[t],n[t]=e;return this.tracks=n,this},random:function(){return this.tracks[Math.floor(Math.random()*this.tracks.length)]},isPlaying:function(){return this.playing},play:function(t){var e=this;if((t=t||(e.current?e.tracks.findIndex(function(t){return t.id===e.current}):0))>=e.tracks.length&&e.looping)t=0;else if(t>=e.tracks.length)return e.current="",void(e.playing=!1);var o=e.tracks[t],n=o.isLooping();return o.loop(!1),o.play(),e.playing=!0,setTimeout(function(){o.isPlaying()||(e.playing=!1)},20),e.current=o.id,o.$el.one("ended.playlist",function(){t++,o.loop(n),e.play(t)}),e},loop:function(t){return this.looping=!!t,this},stop:function(){var t=a.get(this.current);return t.stop(),t.$el.off(".playlist"),this.current="",this.playing=!1,this},pause:function(){return a.get(this.current).pause(),this.playing=!1,this}},u.classes.Playlist=c,u.createPlaylist=c.add,u.playlist=function(t){return c.list[t]||null},u.extend=function(t){i(u,t)},u.extendTrack=a.extend,u.extendTrackProto=a.extendPrototype,u.extendGroup=u.group.extend,u.extendGroupProto=u.group.extendPrototype,u.extendPlaylist=c.extend,u.extendPlaylistProto=c.extendPrototype,window.Chapel=window.Chapel||{},window.Chapel.Audio=u,options.persistPrefs&&u.loadPrefs()}(),function(){"use strict";if(options.controls.show){var t=$(document.createElement("input")).attr({id:"audio-volume",type:"range",min:1,max:99,step:1}),e=Math.trunc(100*window.Chapel.Audio.master.volume);e<0?e=0:100<e&&(e=100),t.attr("value",e),t.on("input",function(){window.Chapel.Audio.volume($(this).val()/100)});var o=$(document.createElement("tw-link")).attr("id","audio-mute").append("Mute <span></span>").on("click",function(t){t.preventDefault(),$(this).toggleClass("muted"),Chapel.Audio.mute(!Chapel.Audio.isMuted())});Chapel.Audio.isMuted()&&o.addClass("muted");var n=$(document.createElement("tw-link")).attr("id","audio-panel-toggle").on("click",function(t){t.preventDefault(),i.toggleClass("closed")}),i=$(document.createElement("div")).attr("id","audio-controls").append(t,o,n).appendTo(document.body);options.controls.startClosed&&i.addClass("closed"),window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.controls={$panel:i,$volume:t,$mute:o,close:function(){i.addClass("closed")},open:function(){i.removeClass("closed")},toggle:function(){i.toggleClass("closed")},hide:function(){i.css("display","none")},show:function(){i.css("display","block")}}}}(),function(){"use strict";var e=State,t=$(document.createElement("div")).attr("id","audio-overlay").css("display","none").appendTo(document.body);function o(){t.css("display","block").append('<div class="lds-ring"><div></div><div></div><div></div><div></div></div>')}function u(){t.fadeOut(function(){t.empty()})}window.Chapel=window.Chapel||{},window.Chapel.Audio=window.Chapel.Audio||{},window.Chapel.Audio.loadScreen={show:o,dismiss:u,kill:function(){$("#audio-overlay").remove()}},window.Chapel.Audio.$overlay=t,window.Chapel.Audio.preload=function(){if(!e.pastLength&&!e.futureLength){$(document).ready(function(){o()});var n=100+options.loadDelay,t=Chapel.Audio.classes.Track.list,i=Chapel.Audio.loaded;if(t.length){var r=t.map(function(t){return t.id});options.forceDismiss&&setTimeout(function(){console.error("HAL.js: some audio sources could not be loaded within the `forceDismiss` time limit."),u()},options.forceDismiss),function t(){if(r.length){var e=r.shift();if(i.includes(e))t();else{var o=Chapel.Audio.classes.Track.get(e);o.unwrap.readyState<2?o.$el.one("canplay",function(){t()}):(i.includes(e)||i.push(e),t())}}else setTimeout(u,n)}()}else setTimeout(u,n)}}}(),function(){"use strict";options.globalA&&void 0===window.A&&(window.A=window.Chapel.Audio),$(document).on("unload",function(){window.Chapel.Audio.savePrefs()}),Chapel.Audio.classes.Track.renew()}(),function(){"use strict";var n=window.prompt;window.prompt=function(){var t,e,o=n.apply(null,[].slice.call(arguments));return t=o,e=(new DOMParser).parseFromString(t,"text/html"),Array.from(e.body.childNodes).some(function(t){return 1===t.nodeType})?o.replace(/[<>]/g,""):o}}();

}());